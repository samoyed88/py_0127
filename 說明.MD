# 專案說明（教學式）

此專案是一個小型「文字遊戲娛樂城」，目的在於把幾個單機文字遊戲整合成一個可下注、管理籌碼的系統，方便在終端（Terminal）中以互動方式遊玩、下注並追蹤籌碼變動。本文以繁體中文、教學方式詳細說明專案目的、架構、使用方法、API 規格與後續擴充建議。

---

## 一、專案目的

- 將單機互動遊戲（21 點、比大小、猜拳）整合成一個統一介面，讓玩家可以用籌碼下注並在輸贏後自動結算。
- 提供簡單的籌碼管理 API（記憶體儲存），作為後續持久化或多人支援的基礎。
- 讓每個遊戲以函式（API）形式暴露給主選單呼叫，便於測試與擴充。

## 二、專案結構（檔案一覽）

工作目錄：`/Users/ianho/python_0119`

- `21point.py`：21 點（Blackjack）遊戲。互動式玩法，已修改為回傳 -1/0/1 的結果，並提供 `play_with_bet(bet)` wrapper 以供 `db.py` 呼叫。
- `big.py`：比大小遊戲（High Card）。玩家與電腦各抽 1~13，比較大小。已補完並可直接執行。
- `rps.py`：猜拳（Rock-Paper-Scissors），此檔案在專案中（如果尚未新增，請讓我代為新增）。
- `db.py`：籌碼管理器與互動選單（娛樂城主程式）。提供下注、載入遊戲模組與依遊戲回傳結果結算籌碼的邏輯。
- `guess.py`, `1a1b.py` 等：原始遊戲檔（部分已改寫為可匯入的函式），目前專注於 21 點、比大小與猜拳三個遊戲。
- `說明.MD`：本檔，包含完整教學與 API 規格（繁體中文）。

## 三、設計概念與契約

1. 籌碼管理（簡單記憶體 DB）
   - `get_balance(user='player') -> int`
   - `change_balance(user, delta) -> int`：調整籌碼並回傳新餘額。
   - `place_bet(user, amount) -> (bool, new_balance)`：嘗試下注（從餘額扣除），若下注成功回傳 True 並返回扣款後餘額，否則 False。

2. 遊戲 API 約定
   - 每個遊戲模組應提供一個可被 `db.py` 呼叫的函式，建議名稱 `play_with_bet(bet)`，但若遊戲沒有接受參數也可支援。
   - `play_with_bet`（或被呼叫的主函式）執行一輪互動遊戲，並回傳以下結果之一：
     - `1`：玩家贏
     - `0`：平手（Push）
     - `-1`：玩家輸
   - `db.py` 會依照這個回傳值做結算（預設賠率 1:1，也就是贏家獲得等於下注額的淨利）。

3. 結算範例
   - 玩家下注 100，若回傳 `1`（贏），則先在下注時扣 100（玩家餘額減少 100），結算時會再給回 200（淨得 +100），最終玩家淨利 +100。
   - 若回傳 `0`（平手），會退還下注金額（玩家不損不 gain）。
   - 若回傳 `-1`（輸），下注金不退（玩家損失下注金）。

## 四、如何執行（快速開始）

1. 開啟終端並切換到專案目錄：

```bash
cd /Users/ianho/python_0119
```

2. 在終端執行主選單：

```bash
python3 db.py
```

3. 依畫面指示選擇遊戲編號，輸入下注金額，接著遊戲會以互動方式進行（例如 21 點會要求輸入 `h` 或 `s`，猜拳會要求出拳等）。

4. 每局結束會依結果自動顯示籌碼變動。

注意：若你想在 macOS 的 zsh 中運行，請確認 `python3` 指向你的系統 Python（或使用 `python` 視你的環境而定）。

## 五、單檔說明與 API 範例

- `db.py`（娛樂城主程式）
  - `interactive_menu()`：互動選單主迴圈（選遊戲、下注、呼叫遊戲、結算）。
  - `run_game_with_bet(module_name, play_func_name='play_with_bet')`：載入模組並呼叫遊戲函式，處理下注與結算流程。

- `21point.py`（21 點）
  - `play_round()`：執行一回合互動 21 點，現在會回傳 -1/0/1 作為結果。
  - `play_with_bet(bet=0)`：對外 wrapper，呼叫 `play_round()` 並回傳結果給 `db.py`。

- `big.py`（比大小）
  - `draw_number()` / `compare()` 等函式，`main()` 可直接執行互動遊戲。可新增 `play_with_bet()` wrapper 以符合 `db.py` 的預期。

- `rps.py`（猜拳，Rock-Paper-Scissors）
  - 建議函式 `play_with_bet()`：要求玩家出拳（剪刀/石頭/布），隨機電腦出拳，回傳 -1/0/1。

## 六、測試建議

1. 語法檢查

```bash
python3 -m py_compile *.py
```

2. 手動測試
   - 執行 `python3 db.py`，選擇每個遊戲並嘗試不同下注額，確認籌碼變動與互動流程正確。

3. 自動測試（進階）
   - 可以為每個遊戲建立非互動的「模擬」版本（例如接受一個隨機種子或自動化決策）以便於單元測試。

## 七、如何擴充（實務建議）

1. 持久化帳戶與籌碼
   - 把 `_balances` 儲存在 `players.json` 或 SQLite，讓玩家重啟後能保留籌碼。

2. 多玩家支援
   - 在 `db.py` 中增加登入流程與多玩家選擇，並把下注與結算與玩家 ID 綁定。

3. 賠率規則
   - 針對不同遊戲（例如 21 點 blackjack 可能有 3:2 賠率）把遊戲回傳格式改成 `(result, multiplier)`，並在 `db.py` 用 multiplier 計算給付。

4. 日誌與紀錄
   - 記錄每次下注與結果到 CSV 或資料庫，便於分析與回檔。

## 八、常見疑問（FAQ）

- 我可以把更多遊戲加進來嗎？
  - 可以。只要遊戲模組提供一個可被呼叫的函式（建議 `play_with_bet(bet)`）並回傳 -1/0/1（或 `(result, multiplier)`），`db.py` 可動態載入並呼叫。

- 如何改成真人對戰或網路多人？
  - 需要把 `db.py` 的單機選單改為伺服端（例如 Flask / FastAPI），並把玩家資料與會話存在後端資料庫之中。

## 九、我可以幫你做的後續工作（選項）

1. 我可以幫你新增 `rps.py`（猜拳）並實作 `play_with_bet()`。
2. 我可以把 `db.py` 的結算改為支援 `(result, multiplier)` 的回傳格式（以支援 Blackjack 的 3:2 賠率）。
3. 我可以把籌碼儲存改為 JSON 檔案並實作登入流程。

如果你想要我接著做其中一項，告訴我你想要哪一項，我會在下一步開始實作，並更新 TODO 清單與回報進度。

---

檔案建立日期：2026-01-27
